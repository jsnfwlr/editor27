YUI.add("moodle-atto_mathjax-button",function(e,t){M.atto_mathjax=M.atto_mathjax||{dialogue:null,selection:null,display_equation:function(e,t){e.preventDefault(),M.editor_atto.is_active(t)||M.editor_atto.focus(t),M.atto_mathjax.selection=M.editor_atto.get_selection();if(M.atto_mathjax.selection!==!1){var n;M.atto_mathjax.dialogue?n=M.atto_mathjax.dialogue:n=new M.core.dialogue({visible:!1,modal:!0,close:!0,draggable:!0}),n.render(),n.set("bodyContent",M.atto_mathjax.get_form_content(t)),n.set("headerContent",M.util.get_string("editequation","atto_mathjax")),M.atto_mathjax.load_equation(),n.show(),MathJax.Hub.Queue(["Typeset",MathJax.Hub,"atto_mathjax_preview"]),M.atto_mathjax.dialogue=n}},init:function(e){M.editor_atto.add_toolbar_button(e.elementid,"mathjax",e.icon,e.group,this.display_equation,this)},load_equation:function(){var t=M.editor_atto.get_selection_parent_node(),n,r,i;if(!t)return;n=e.one(t).get("text"),r=/\$\$.*\$\$/,i=r.exec(n),i&&(i=i[0].replace(/\$\$/g,""),e.one("#atto_mathjax_equation").set("text",i),e.one("#atto_mathjax_preview").set("text","$$"+i+"$$"))},update_preview:function(t){var n=e.one(t.currentTarget).get("value"),r=null;MathJax.Hub.Queue(function(){r=MathJax.Hub.getAllJax("atto_mathjax_preview")[0]}),MathJax.Hub.Queue(["Text",r,n])},set_equation:function(t,n){var r,i,s,o,u,a;t.preventDefault(),M.atto_mathjax.dialogue.hide(),M.editor_atto.set_selection(M.atto_mathjax.selection),r=t.currentTarget.ancestor(".atto_form").one("textarea"),a=r.get("value"),a!==""&&(a="$$ "+a.trim()+" $$",i=e.one(M.editor_atto.get_selection_parent_node()),s=i.get("text"),o=/\$\$.*\$\$/,u=o.exec(s),u?(s=s.replace(u,"$$"+a+"$$"),i.set("text",s)):document.selection&&document.selection.createRange().pasteHTML?document.selection.createRange().pasteHTML(a):document.execCommand("insertHTML",!1,a),M.editor_atto.text_updated(n))},get_form_content:function(t){var n=e.Node.create('<form class="atto_form"><label for="atto_mathjax_equation">'+M.util.get_string("editequation","atto_mathjax")+"</label>"+'<textarea class="fullwidth" id="atto_mathjax_equation" rows="8"></textarea><br/>'+"<br/>"+'<label for="atto_mathjax_preview">'+M.util.get_string("preview","atto_mathjax")+' ( <a href="#"> Update </a> )'+"</label>"+'<div class="fullwidth" id="atto_mathjax_preview" aria-live="polite">$$ $$</div>'+'<div class="mdl-align">'+"<br/>"+'<button id="atto_mathjax_submit">'+M.util.get_string("save","atto_mathjax")+"</button>"+"</div>"+"</form>"+"<hr/>"+M.util.get_string("equationhelp","atto_mathjax"));return n.one("#atto_mathjax_submit").on("click",M.atto_mathjax.set_equation,this,t),n.one("#atto_mathjax_equation").on("change",M.atto_mathjax.update_preview,this,t),n}}},"@VERSION@",{requires:["node","escape"]});
